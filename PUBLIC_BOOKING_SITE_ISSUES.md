# 予約サイトの画面の問題点・改善点

## 🔴 重大な問題

### 1. **ListView.tsx の貸切申し込みボタンの日付パラメータが間違っている**
- **場所**: `src/pages/PublicBookingTop/components/ListView.tsx:46`
- **問題**: `window.location.hash = '#private-booking-select?date=${timeSlot}&store=${store.id}&slot=${timeSlot}'`
  - `date=${timeSlot}` となっているが、`timeSlot`は 'morning'/'afternoon'/'evening' の文字列
  - 日付が正しく渡されていない
- **影響**: 貸切申し込みボタンをクリックしても正しい日付が選択されない

### 2. **残席数の計算ロジックが統一されていない**
- **場所**: 
  - `CalendarView.tsx:138`
  - `ListView.tsx:56`
- **問題**: `const available = (event.max_participants || 8) - (event.current_participants || 0)`
  - `scenarios.player_count_max`が優先されていない
  - `useBookingData.ts`や`useScenarioDetail.ts`では修正済みだが、表示コンポーネントが未反映
- **影響**: 満席誤表示の可能性

## 🟡 中程度の問題

### 3. **日付表示に年が含まれていない**
- **場所**: `ScenarioCard.tsx:27-31` の `formatDate` 関数
- **問題**: `11/4` のように月/日のみ表示（年なし）
- **影響**: 年をまたぐ場合に混乱する可能性
- **改善案**: 年を含める、または年が異なる場合のみ表示

### 4. **店舗データ取得失敗時のエラーハンドリングが不十分**
- **場所**: `useBookingData.ts:59-63`
- **問題**: エラー時に空配列で続行するが、ユーザーに通知がない
- **影響**: 店舗フィルターが表示されない、店舗名が「店舗不明」になる
- **改善案**: エラーメッセージを表示、リトライ機能

### 5. **ローディング状態がシンプルすぎる**
- **場所**: `PublicBookingTop/index.tsx:131-134`
- **問題**: 単純なテキストのみ（「読み込み中...」）
- **影響**: ユーザー体験が悪い、実際に読み込み中か判断しづらい
- **改善案**: スケルトンローダー、プログレスバー

### 6. **空の状態のメッセージがシンプルすぎる**
- **場所**: 
  - `LineupView.tsx:100-102`
  - `ScenarioDetailPage/index.tsx:161`
- **問題**: 「シナリオが見つかりませんでした」のみ
- **影響**: 理由が分からない、次に何をすべきか不明
- **改善案**: 検索条件の変更を促す、フィルターリセットボタン

## 🟢 軽微な問題・改善の余地

### 7. **型定義の不整合**
- **場所**: `LineupView.tsx:5-20` の `ScenarioWithEvents` インターフェース
- **問題**: 実際に使用されている `ScenarioCardType` と異なる型定義
- **影響**: 型安全性の低下、メンテナンス性の低下

### 8. **店舗フィルターの状態がタブ間で共有されていない**
- **場所**: `PublicBookingTop/index.tsx`
- **問題**: カレンダーとリストビューで同じ店舗フィルターを使用しているが、UX的には分離すべき？
- **影響**: ユーザーが意図しないフィルター状態になる可能性

### 9. **カレンダービューのスクロールバーが見づらい**
- **場所**: `CalendarView.tsx:123`
- **問題**: `scrollbar-thin` を使用しているが、ブラウザによっては表示されない
- **影響**: スクロール可能か分からない

### 10. **次回公演の省略表示が不明確**
- **場所**: `ScenarioCard.tsx:133-137`
- **問題**: 「...他 X件」と表示されるが、クリックしても詳細を見られない
- **影響**: ユーザーが全ての公演を確認できない

### 11. **シナリオカードのタイトルが長い場合の処理**
- **場所**: `ScenarioCard.tsx:82-84`
- **問題**: `truncate` で切り捨てられるが、ホバーで全文表示されない
- **影響**: 長いタイトルが読めない

### 12. **お気に入り機能が未ログイン時も表示される**
- **場所**: `ScenarioCard.tsx:61-74`
- **問題**: ログインしていなくてもお気に入りボタンが表示される（機能は動作するが、UX的に分かりにくい）
- **影響**: ユーザーがお気に入り機能の有無を判断しづらい

### 13. **レスポンシブデザインの確認不足**
- **場所**: 全体的
- **問題**: グリッドカラム数は設定されているが、スマホ表示の確認が不十分
- **影響**: モバイルでの使い勝手が悪い可能性

### 14. **エラーメッセージの統一性**
- **場所**: `useBookingActions.ts:22, 28, 33`
- **問題**: `alert()` を使用している（UIコンポーネントを使うべき）
- **影響**: ブラウザのネイティブダイアログで統一感がない

### 15. **シナリオ詳細ページの戻るボタンの動作**
- **場所**: `ScenarioDetailPage/index.tsx:175-182`
- **問題**: `onClose` が未定義の場合の動作が不明
- **影響**: 戻るボタンが動作しない可能性

## 📝 改善優先度の高い項目

1. **ListView.tsx の貸切申し込みボタンの日付パラメータ修正** (🔴)
2. **残席数計算ロジックの統一** (🔴)
3. **日付表示に年の追加** (🟡)
4. **エラーハンドリングの改善** (🟡)
5. **ローディング状態の改善** (🟡)

