# 貸切公演 時間調整ルール

## 基本設定

| 項目 | 値 | 備考 |
|------|-----|------|
| 最早開始時間 | 9:00 | これより早い開始は不可 |
| 最遅終了時間 | 23:00 | これより遅い終了は不可 |
| 営業時間 | 14時間 | 9:00〜23:00 = 840分 |
| 片付け時間 | 30分 | 公演終了後の清掃・片付け |
| 切り替え時間（最短） | 60分 | 片付け30分 + 準備30分 |
| 切り替え時間（基本） | 90分 | 片付け30分 + 準備・余裕60分 |

---

## 判定ロジック

### 公演数の判定式

| 公演数 | 判定式（基本90分切替） | 判定式（最短60分切替） |
|--------|----------------------|----------------------|
| 3公演 | 合計シナリオ時間 + 180分 ≦ 840分 | 合計シナリオ時間 + 120分 ≦ 840分 |
| 2公演 | 合計シナリオ時間 + 90分 ≦ 840分 | 合計シナリオ時間 + 60分 ≦ 840分 |

**シンプルに:**
- **3公演（90分切替）**: 合計 ≦ 660分（11時間）
- **3公演（60分切替）**: 合計 ≦ 720分（12時間）
- **2公演（90分切替）**: 合計 ≦ 750分（12.5時間）
- **2公演（60分切替）**: 合計 ≦ 780分（13時間）

### 同一シナリオの場合

| シナリオ時間 | 3公演（90分） | 3公演（60分） | 2公演（90分） | 2公演（60分） |
|-------------|--------------|--------------|--------------|--------------|
| 3h（180分）  | ✓ 540分     | ✓ 540分     | ✓ 360分     | ✓ 360分     |
| 3.5h（210分）| ✓ 630分     | ✓ 630分     | ✓ 420分     | ✓ 420分     |
| 4h（240分）  | ✗ 720分     | ✓ 720分     | ✓ 480分     | ✓ 480分     |
| 4.5h（270分）| ✗ 810分     | ✗ 810分     | ✓ 540分     | ✓ 540分     |
| 5h（300分）  | ✗ 900分     | ✗ 900分     | ✓ 600分     | ✓ 600分     |
| 5.5h（330分）| ✗ 990分     | ✗ 990分     | ✓ 660分     | ✓ 660分     |
| 6h（360分）  | ✗ 1080分    | ✗ 1080分    | ✓ 720分     | ✓ 720分     |
| 6.5h（390分）| ✗            | ✗            | ✗ 780分     | ✓ 780分     |
| 7h（420分）  | ✗            | ✗            | ✗ 840分     | ✗ 840分     |

---

## 公演枠の基本時間

| 枠 | デフォルト開始 | 備考 |
|----|--------------|------|
| 朝公演 | 10:00 | シナリオ時間により9:00まで早める |
| 昼公演 | 14:00 | 朝公演終了+切替後 |
| 夜公演 | 18:00 | 昼公演終了+切替後 |

---

## 時間調整ルール

### 朝公演の調整

| 条件 | 対応 |
|------|------|
| 朝公演終了+90分が14:00を超える | 朝公演開始を早める（最早9:00） |
| 朝公演を9:00にしても昼公演14:00に間に合わない | 昼公演開始を遅らせる（最短60分間隔まで） |

### 昼公演の調整

| 条件 | 対応 |
|------|------|
| 昼公演終了+90分が18:00を超える | 夜公演開始を遅らせる |
| 昼公演終了+60分後でも23:00を超える | 夜公演は不可 |

### 夜公演の調整

| 条件 | 対応 |
|------|------|
| 夜公演が23:00を超える | 夜公演開始を早める（昼公演終了+60分まで） |
| 開始を早めても23:00を超える | 夜公演は不可（1日2公演のみ） |

---

## 主要パターン例

### 3公演パターン（切替90分）

| パターン | 朝公演 | 昼公演 | 夜公演 | 合計 |
|---------|--------|--------|--------|------|
| 3h + 3h + 3h | 10:00〜13:00 | 14:30〜17:30 | 19:00〜22:00 | 9h |
| 3.5h + 3h + 3h | 9:30〜13:00 | 14:30〜17:30 | 19:00〜22:00 | 9.5h |
| 4h + 3h + 3h | 9:00〜13:00 | 14:30〜17:30 | 19:00〜22:00 | 10h |
| 4h + 3h + 3.5h | 9:00〜13:00 | 14:30〜17:30 | 19:00〜22:30 | 10.5h |
| 4h + 4h + 3h | 9:00〜13:00 | 14:30〜18:30 | 20:00〜23:00 | 11h |
| 4.5h + 3h + 3h | 9:00〜13:30 | 15:00〜18:00 | 19:30〜22:30 | 10.5h |
| 5h + 3h + 3h | 9:00〜14:00 | 15:30〜18:30 | 20:00〜23:00 | 11h |

### 3公演パターン（切替60分）

切替を60分に短縮すると、以下のパターンも可能：

| パターン | 朝公演 | 昼公演 | 夜公演 | 合計 |
|---------|--------|--------|--------|------|
| 4h + 4h + 4h | 9:00〜13:00 | 14:00〜18:00 | 19:00〜23:00 | 12h |
| 5h + 3.5h + 3.5h | 9:00〜14:00 | 15:00〜18:30 | 19:30〜23:00 | 12h |
| 5.5h + 3h + 3h | 9:00〜14:30 | 15:30〜18:30 | 19:30〜22:30 | 11.5h |
| 5.5h + 3.5h + 3h | 9:00〜14:30 | 15:30〜19:00 | 20:00〜23:00 | 12h |

### 2公演パターン（切替90分）

| パターン | 朝公演 | 昼公演 | 備考 |
|---------|--------|--------|------|
| 5h + 5h | 9:00〜14:00 | 15:30〜20:30 | 余裕あり |
| 5.5h + 5h | 9:00〜14:30 | 16:00〜21:00 | 余裕あり |
| 6h + 5h | 9:00〜15:00 | 16:30〜21:30 | 余裕あり |
| 6h + 6h | 9:00〜15:00 | 16:30〜22:30 | 余裕あり |
| 6.5h + 5.5h | 9:00〜15:30 | 17:00〜22:30 | ギリギリ |

### 2公演パターン（切替60分）

| パターン | 朝公演 | 昼公演 | 備考 |
|---------|--------|--------|------|
| 6.5h + 6h | 9:00〜15:30 | 16:30〜22:30 | ギリギリ |
| 7h + 5.5h | 9:00〜16:00 | 17:00〜22:30 | ギリギリ |
| 7h + 6h | 9:00〜16:00 | 17:00〜23:00 | ギリギリ |

---

## 詳細例

### 例1: 3時間 × 3（標準パターン）

| 公演 | シナリオ | 時間 |
|------|---------|------|
| 朝公演 | 3h | 10:00〜13:00 |
| 切替 | 90分 | 13:00〜14:30 |
| 昼公演 | 3h | 14:30〜17:30 |
| 切替 | 90分 | 17:30〜19:00 |
| 夜公演 | 3h | 19:00〜22:00 |

### 例2: 4h + 4h + 4h（60分切替で可能）

| 公演 | シナリオ | 時間 |
|------|---------|------|
| 朝公演 | 4h | 9:00〜13:00 |
| 切替 | 60分 | 13:00〜14:00 |
| 昼公演 | 4h | 14:00〜18:00 |
| 切替 | 60分 | 18:00〜19:00 |
| 夜公演 | 4h | 19:00〜23:00 |

### 例3: 5.5h + 3h + 3h（60分切替で可能）

| 公演 | シナリオ | 時間 |
|------|---------|------|
| 朝公演 | 5.5h | 9:00〜14:30 |
| 切替 | 60分 | 14:30〜15:30 |
| 昼公演 | 3h | 15:30〜18:30 |
| 切替 | 60分 | 18:30〜19:30 |
| 夜公演 | 3h | 19:30〜22:30 |

### 例4: 6h + 6h（2公演パターン）

| 公演 | シナリオ | 時間 |
|------|---------|------|
| 朝公演 | 6h | 9:00〜15:00 |
| 切替 | 90分 | 15:00〜16:30 |
| 昼公演 | 6h | 16:30〜22:30 |

---

## 注意事項

1. **お客様への案内**
   - 貸切リクエスト時「開始時間は店舗の状況により調整させていただく場合があります」と明記
   - 時間変更が必要な場合は、お客様に確認してから確定

2. **店舗側の運用**
   - 基本は90分切替で計算
   - 繁忙期や特殊な状況では60分切替も検討可
   - 長時間シナリオは事前に時間調整の可能性を伝える

3. **更新履歴**
   - 2026-01-02: 初版作成
   - 2026-01-02: ハイブリッド形式にリファクタリング（ロジック + 主要パターン）
   - 2026-01-02: 60分切替パターンを追加

---

## 将来的な拡張案

- [ ] シナリオ時間に応じた開始時間の自動計算機能
- [ ] 1日の公演数上限をシナリオごとに設定
- [ ] 店舗ごとの営業時間設定
