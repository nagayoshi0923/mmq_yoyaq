#!/usr/bin/env python3
"""
ã‚·ãƒŠãƒªã‚ªã®å…¬æ¼”å¯èƒ½åº—èˆ—ï¼ˆavailable_storesï¼‰ã‚’ä¸€æ‹¬æ›´æ–°ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
"""

import os
import re
from typing import List, Set

# Supabaseæ¥ç¶šæƒ…å ±ã‚’.envã‹ã‚‰èª­ã¿è¾¼ã¿
def load_env():
    env_vars = {}
    try:
        with open('.env', 'r') as f:
            for line in f:
                line = line.strip()
                if line and not line.startswith('#') and '=' in line:
                    key, value = line.split('=', 1)
                    env_vars[key] = value
    except FileNotFoundError:
        pass
    return env_vars

env = load_env()
SUPABASE_URL = env.get('VITE_SUPABASE_URL', '')
SUPABASE_KEY = env.get('VITE_SUPABASE_ANON_KEY', '')

# åº—èˆ—IDãƒãƒƒãƒ”ãƒ³ã‚°
STORE_IDS = {
    "å¤§ä¹…ä¿": "bef973a7-faa2-466d-afcc-c6466f24474f",
    "é¦¬å ´": "45e39d14-061f-4d01-ae8a-5d4f8893e3cd",
    "åˆ¥é¤¨â‘ ": "0269032f-6059-440b-a429-9a56dbb027be",
    "åˆ¥é¤¨â‘¡": "95ac6d74-56df-4cac-a67f-59fff9ab89b9",
    "å¤§å¡š": "f94256c3-e992-4723-b965-9df5cd54ea81",
    "åŸ¼ç‰å¤§å®®": "8a254b6d-9293-42c6-b634-e872c83fc4fd",
}

# å…¨åº—èˆ—ID
ALL_STORE_IDS = list(STORE_IDS.values())

def parse_stores(store_text: str) -> List[str]:
    """
    åº—èˆ—ãƒ†ã‚­ã‚¹ãƒˆã‚’è§£æã—ã¦store_idã®ãƒªã‚¹ãƒˆã‚’è¿”ã™
    """
    if not store_text or store_text.strip() == "":
        return ALL_STORE_IDS
    
    store_text = store_text.strip()
    
    # å…¨åº—èˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³
    if "å…¨åº—èˆ—" in store_text or store_text == "ä¿ç•™":
        return ALL_STORE_IDS
    
    store_ids: Set[str] = set()
    
    # ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿ã§åˆ†å‰²ï¼ˆãƒ»ã€ï¼Œ,ï¼‰
    parts = re.split(r'[ãƒ»ã€ï¼Œ,\s]+', store_text)
    
    for part in parts:
        part = part.strip()
        if not part:
            continue
            
        # å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒãƒƒãƒ
        if part in ("å¤§ä¹…ä¿", "å¤§ä¹…ä¿åº—"):
            store_ids.add(STORE_IDS["å¤§ä¹…ä¿"])
        elif part in ("é¦¬å ´", "é«˜ç”°é¦¬å ´", "é¦¬å ´åº—", "é«˜ç”°é¦¬å ´åº—"):
            store_ids.add(STORE_IDS["é¦¬å ´"])
        elif part in ("å¤§å¡š", "å¤§å¡šåº—"):
            store_ids.add(STORE_IDS["å¤§å¡š"])
        elif part in ("ä»®è¨­", "ä»®èª¬", "åˆ¥é¤¨", "é¦¬å ´ä»®è¨­", "é¦¬å ´åˆ¥é¤¨"):
            # åˆ¥é¤¨â‘ â‘¡ä¸¡æ–¹
            store_ids.add(STORE_IDS["åˆ¥é¤¨â‘ "])
            store_ids.add(STORE_IDS["åˆ¥é¤¨â‘¡"])
        elif part in ("åˆ¥é¤¨â‘ ", "åˆ¥é¤¨1"):
            store_ids.add(STORE_IDS["åˆ¥é¤¨â‘ "])
        elif part in ("åˆ¥é¤¨â‘¡", "åˆ¥é¤¨2"):
            store_ids.add(STORE_IDS["åˆ¥é¤¨â‘¡"])
        elif part in ("åŸ¼ç‰", "å¤§å®®", "åŸ¼ç‰å¤§å®®", "åŸ¼ç‰å¤§å®®åº—"):
            store_ids.add(STORE_IDS["åŸ¼ç‰å¤§å®®"])
        elif "éæ¨å¥¨" in part:
            # ã€Œå¤§ä¹…ä¿éæ¨å¥¨ã€ãªã©ã¯ç„¡è¦–ï¼ˆå«ã‚ã‚‹æŒ‡ç¤ºãªã®ã§ï¼‰
            continue
        elif part.startswith("ï¼ˆ") or part.startswith("("):
            # æ‹¬å¼§å†…ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯ç„¡è¦–
            continue
        elif "ã¾ã§" in part or "é™å®š" in part:
            # ã€Œï¼•æœˆã¾ã§ã€ã€Œå¹³æ—¥é™å®šã€ãªã©ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯ç„¡è¦–
            continue
        elif part == "â€»å¹³æ—¥é™å®šã«ã—ãŸã„":
            continue
        else:
            print(f"âš ï¸ æœªçŸ¥ã®åº—èˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³: '{part}'")
    
    return list(store_ids) if store_ids else ALL_STORE_IDS


# ã‚·ãƒŠãƒªã‚ªã¨åº—èˆ—ã®ãƒãƒƒãƒ”ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿
SCENARIO_STORE_DATA = """
æ›™å…‰ã®ã‚¨ãƒ†ãƒ«ãƒŠ	å…¨åº—èˆ—ï¼ˆå¤§ä¹…ä¿éæ¨å¥¨ï¼‰
ã‚°ãƒ­ãƒªã‚¢ãƒ¡ãƒ¢ãƒªãƒ¼ã‚º	å¤§å¡š
ãƒãƒ¼ãƒ€ãƒ¼ãƒ»ã‚ªãƒ–ãƒ»ãƒ‘ã‚¤ãƒ¬ãƒ¼ãƒ„	
over kill	åˆ¥é¤¨ãƒ»å¤§å¡š
BrightChoice	å¤§å¡š
è£ãã‚‚ã®ã€è£ã‹ã‚Œã‚‹ã‚‚ã®	å¤§å¡š
æ˜Ÿ	
æ¸…æµé¤¨ã®ç§˜å®	
å¥ªã†ã‚‚ã®ã€å¥ªã‚ã‚Œã‚‹ã‚‚ã®	
è¶…ç‰¹æ€¥ã®å‘ªã„ã®é¤¨ã§æ’®ã‚Œé«˜è¶³ã‚Šã¦ã¾ã™ã‹ï¼Ÿ	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
BBA	ä¿ç•™
DearmyD	é¦¬å ´ãƒ»ä»®è¨­
Iwillex-	é¦¬å ´ãƒ»ä»®è¨­
Recollection	é¦¬å ´ãƒ»ä»®è¨­
WANTEDz	å¤§ä¹…ä¿
ã‚¢ãƒ³ãƒ•ã‚£ã‚¹ãƒã‚¨ãƒŠã¨è–å¥³ã®ç¥ˆã‚Š	é¦¬å ´ãƒ»å¤§å¡š
ã‚¦ãƒ­ãƒœãƒ­ã‚¹ã®çœ ã‚Š	é¦¬å ´ãƒ»ä»®è¨­
ã‚¯ãƒªã‚¨ã‚¤ã‚¿ãƒ¼ã‚ºãƒã‚¤	é¦¬å ´ãƒ»ä»®è¨­
ã¤ã‚ã‚‚ã®ã©ã‚‚ãŒå¤¢ã®ã‚ã¨	é¦¬å ´ãƒ»ä»®è¨­
ãƒ‰ã‚¯ã‚¿ãƒ¼ãƒ»ãƒ†ãƒ©ã‚¹ã®ç§˜å¯†ã®å®Ÿé¨“	é¦¬å ´ãƒ»ä»®è¨­
ãƒãƒ™ãƒ«ã®æœ«è£”	
ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¹ã‚¯ãƒ©ãƒ³ãƒ–ãƒ«	
ã²ãã‚‰ã—ã®ãªãé ƒã«ã€€æ¨è¿”ã—ç·¨	
ãƒ•ã‚§ã‚¤ã‚¯ãƒ‰ãƒŠãƒ¼	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§ä¹…ä¿
ãƒªã‚¢ãƒ«ãƒãƒ€ãƒŸã‚¹-MurderWonderLand	å¤§å¡š
ãƒªã‚¢ãƒ«ãƒãƒ€ãƒŸã‚¹-ç›¤ä¸Šã®æ•™çš‡	å¤§å¡š
ãƒªãƒˆãƒ«ãƒ¯ãƒ³ãƒ€ãƒ¼	å¤§å¡š
æ‚ªæ„ã®å²è·¯ã«ç«‹ã¤	
æˆ–ãƒ«èƒ¡è¶ãƒå¤¢	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
èŠ±è¡—ãƒªã‚°ãƒ¬ãƒƒãƒˆ	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
éŠ€ä¸–ç•Œã®ã‚¢ã‚·ã‚¢ãƒˆ(ï¼•æœˆã¾ã§ï¼‰	å…¨åº—èˆ—
é»’ã¨ç™½ã®ç‹­é–“ã«	å…¨åº—èˆ—
è£åˆ¤å“¡ã®ä»®é¢	å¤§å¡š
æ­¯ã«å™›ã‚€ã‚ãªãŸã«	é¦¬å ´ãƒ»ä»®è¨­
é¹¿ç¥é¤¨ã®ç½ªäºº	
å¥³çš‡ã®æ›¸æ¶	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
æ–°ä¸–ç•Œã®ãƒ¦ã‚­ã‚µã‚­	å…¨åº—èˆ—
èª å®Ÿãªåå­—æ¶	é¦¬å ´ãƒ»ä»®è¨­
é‰„ç´ºã®è¨¼è¨€	é¦¬å ´ãƒ»ä»®è¨­
éœ§ã«çœ ã‚‹ã¯å¹¾ã¤ã®ç½ª	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
é‡æ§Œ	é¦¬å ´ãƒ»ä»®è¨­
è´–ç½ªã®ãƒ­ã‚¶ãƒªã‚ª	
æ©Ÿå·§äººå½¢ã®å¿ƒè‡“	å…¨åº—èˆ—
å¢ƒç•Œç·šã®ã‚«ãƒ¼ã‚µã‚¹ãƒ™ãƒª	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
è—é›¨å»»é€¢	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
æœˆå…‰ã®å½æ¡œ	é¦¬å ´ãƒ»ä»®è¨­
ã‚¢ãƒ³ã‚·ãƒ³ãƒ¡ãƒˆãƒªãƒ¼	
å¦–æ€ªãŸã¡ã¨æœˆå¤œã®åˆ€	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
ä¹åä¹è«‡ - å„ç½ã®ç®±	
å‘ªç¸›å§«	
æ¡œã®æ•£ã‚‹å¤œã«	
intheboxã€œé•·ã„ç†±ç—…	é¦¬å ´ãƒ»ä»®è¨­
GARDENãƒªãƒ¼ã‚¬ãƒ¼æ®ºäººäº‹ä»¶	
Jazzy	
REDRUM01æ³‰æ¶Œé¤¨ã®å¤‰è»¢	é¦¬å ´ãƒ»é¦¬å ´ä»®è¨­
ã‚¢ã‚ªãƒãƒ«ãƒ¼ãƒ„	
ã‚¢ã‚ªãƒãƒ«ãƒ¼ãƒ—	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
ã‚ããªãä¸–ç•Œã§å˜˜ã‚’ã†ãŸã†	é¦¬å ´ãƒ»ä»®è¨­
ã‚¨ãƒ‡ãƒ³ã®å¯©åˆ¤	é¦¬å ´ãƒ»ä»®è¨­
ã‚­ãƒ³ã‚°ã‚’æ®ºã™ã«ã¯	
ã‚¯ãƒ­ãƒãƒ•ã‚©ãƒ“ã‚¢	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
ã‚¹ã‚¿ãƒ¼ãƒ«ãƒ¼ãƒ—	å¤§ä¹…ä¿
ãƒ„ã‚°ãƒŸãƒ‰ãƒª	é¦¬å ´ãƒ»ä»®è¨­
ãƒŠãƒŠã‚¤ãƒ­ã®è¿·å®® é»„ ã‚¨ãƒ¬ã‚¯ãƒˆãƒªã‚«ãƒ«å¹å¥æ¥½éƒ¨æ®ºäººäº‹ä»¶	é¦¬å ´ãƒ»ä»®è¨­
ãƒŠãƒŠã‚¤ãƒ­ã®è¿·å®® ç·‘ ã‚¢ãƒšã‚¤ãƒ­ãƒ³ç ”ç©¶æ‰€æ®ºäººäº‹ä»¶	é¦¬å ´ãƒ»ä»®è¨­
ãƒŠãƒŠã‚¤ãƒ­ã®è¿·å®® æ©™ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚²ãƒ¼ãƒ æ®ºäººäº‹ä»¶	å…¨åº—èˆ—
ãƒ”ã‚¿ã‚´ãƒ©ã‚¹ã®ç¯ç«	é¦¬å ´ãƒ»ä»®è¨­
ãƒ•ã‚§ã‚¤ã‚¯ã‚¢ãƒ–ãƒ€ã‚¯ã‚·ãƒ§ãƒ³	
ãƒ¤ãƒãƒã®ãƒ•ã‚¿ãƒª	é¦¬å ´ãƒ»ä»®è¨­
ãƒ­ãƒƒã‚¯ãƒ‰ãƒ‰ã‚¢æ®ºäºº	
ä¸€æ¡å®¶ã®äººã€…	é¦¬å ´ãƒ»ä»®è¨­
èŠ±å’²ã®ç®±åº­	é¦¬å ´ãƒ»ä»®è¨­
å­¦æ ¡ã®è§£è«‡	é¦¬å ´
å²è·¯ã«é™ã‚Šç«‹ã¤	é¦¬å ´ãƒ»ä»®è¨­
å­£ç¯€ã®ãƒãƒ¼ãƒ€ãƒ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ï¼ãƒ‹ã‚£ãƒ›ãƒ³	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
å­£ç¯€ãƒãƒ¼ãƒ€ãƒ¼ï¼ã‚¢ãƒ‹ã‚¯ã‚·ã‚£	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
å­£ç¯€ãƒãƒ¼ãƒ€ãƒ¼ï¼ã‚«ãƒã‚±ãƒª	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
å­£ç¯€ãƒãƒ¼ãƒ€ãƒ¼ï¼ã‚­ãƒ¢ãƒŠã‚¹	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
å­£ç¯€ãƒãƒ¼ãƒ€ãƒ¼ï¼ã‚·ãƒãƒãƒ­	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
é¬¼å“­é¤¨ã®æ®ºäººäº‹ä»¶	é¦¬å ´ãƒ»ä»®è¨­
å¤é˜ã®ãªã‚‹é ƒã«	é¦¬å ´ãƒ»ä»®è¨­
è’å»ƒã®ãƒãƒªã‚¹	é¦¬å ´ãƒ»ä»®è¨­
é»’ã®çœºæœ›	é¦¬å ´ãƒ»ä»®è¨­
ä»Šæ—¥ã‚‚æ¶™ã®é›¨ãŒé™ã‚‹	
æ®ºç¥ç½ª	å…¨åº—èˆ—
æ®ºäººé¬¼ã‚¤ãƒãƒ©ãƒãƒŸãƒã®å›æƒ³éŒ²	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
ç´«ã«æŸ“ã¾ã‚‹å‰ã«	é¦¬å ´ãƒ»ä»®è¨­
ä¸ƒè‚¡é«˜æ ¡	
æœ±ãäº¡å›½ã«æ§ã’ã‚‹ç¥ˆã‚Š	é¦¬å ´ãƒ»ä»®è¨­
å°‘å¹´å°‘å¥³Aã®ç‹¬ç™½	
çœŸãƒ»æ¸‹è°·é™°é™½å¥‡è­š	é¦¬å ´ãƒ»ä»®è¨­
äººç‹¼ã‚’èªã‚‹é¤¨	é¦¬å ´ãƒ»ä»®è¨­
æ˜Ÿç©ºã®ãƒãƒªã‚¹	é¦¬å ´ãƒ»ä»®è¨­
å…¨èƒ½ã®ãƒ‘ãƒ©ãƒ‰ãƒƒã‚¯ã‚¹	é¦¬å ´ãƒ»ä»®è¨­
æƒ³ã„ã¯æº€å¤©ã®æ˜Ÿã«	
æ¢åµæ’²æ»…	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§ä¹…ä¿
å¤©é‚ªæ²³ï¼ˆã‚ã¾ã®ã˜ã‚ƒãï¼‰	é¦¬å ´ãƒ»ä»®è¨­
é›»è„³ã®æª»ã®ã‚¢ãƒªã‚¹	å¤§å¡š
ç™½æ®ºã—Type-K	é¦¬å ´ãƒ»ä»®è¨­
ç™¾é¬¼ã®å¤œã€æœˆå…‰ã®å½±	é¦¬å ´ãƒ»ä»®è¨­
åæ¢åµã¨å››å¶ºé¤¨	
å‚²æ…¢ãªå¥³ç‹ã¨ã‚¢ãƒªã‚¹ã®ä¸æ¡ç†è£åˆ¤	é¦¬å ´ãƒ»ä»®è¨­ã€å¤§å¡š
å½—æ˜Ÿè˜­ã®ä¸‡æœ¶	é¦¬å ´ãƒ»ä»®è¨­
ç‡”ç¥­ã®ã‚¸ã‚§ãƒŸãƒ‹	é¦¬å ´ãƒ»ä»®è¨­ã€å¤§å¡š
çµ†ã®æ°¸é€	é¦¬å ´ãƒ»ä»®è¨­
å‡ªã®é¬¼ç±	é¦¬å ´ãƒ»ä»®è¨­
ç•°èƒ½ç‰¹åŒºã‚·ãƒ³ã‚®ãƒ¥ãƒ©ãƒªãƒ†ã‚£	é¦¬å ´ãƒ»ä»®è¨­
ããšã®è‘‰ã®ã‚‚ã‚Š	å¤§ä¹…ä¿
REDRUM4ã‚¢ãƒ«ãƒ†ãƒŸã‚¹ã®æ–­ç½ª	é¦¬å ´ãƒ»ä»®è¨­
ENIGMACODEå»ƒæ£„ãƒŸãƒ©ã‚¤ã®çŠ ç‰²è€…ãŸã¡	é¦¬å ´ãƒ»ä»®è¨­
ãƒ†ã‚»ã‚¦ã‚¹ã®æ–¹èˆŸ	é¦¬å ´ãƒ»ä»®è¨­ã€å¤§å¡š
æ¢ã±ã‚“ãƒãƒ¼ãƒ€ãƒ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ãƒ»ãƒãƒ¼ã‚·ãƒ§ãƒ¼ãƒ„ãƒˆãƒ«ãƒ€ãƒ å­¦åœ’æ®ºäººäº‹ä»¶	é¦¬å ´ãƒ»ä»®è¨­
èŸ»é›†	å¤§å¡š
è‰æ•£	å¤§å¡š
ãã®ç™½è¡£ã¯èª°ãŒç‚ºã«	
5DIVE	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
MERCHANT	é¦¬å ´ãƒ»ä»®è¨­
readme.txt	é¦¬å ´ãƒ»ä»®è¨­
REDRUM02è™šåƒã®F	é¦¬å ´ãƒ»ä»®è¨­
REDRUM03è‡´å‘½çš„è¦³æ¸¬ã‚’ã‚‚ã†ä¸€åº¦	é¦¬å ´ãƒ»ä»®è¨­
TOOLSã€œãã“ã¡ãªã„æ¤…å­	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
ã‚¢ãƒ³ãƒ‰ãƒ­ã‚¤ãƒ‰ã¯æ„›ã‚’çŸ¥ã‚‰ãªã„	å¤§ä¹…ä¿
ã‚­ãƒ²ã‚¯ã®æ–¹èˆŸ	
ã‚¯ãƒªãƒ ã‚¾ãƒ³ã‚¢ãƒ¼ãƒˆ	å¤§ä¹…ä¿
ã“ã®é—‡ã‚’ã‚ãªãŸã¨	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
ãƒ‡ãƒ¢ãƒ³ã‚ºãƒœãƒƒã‚¯ã‚¹	é¦¬å ´ä»®è¨­
ã¸ã£ã©ãã‚â˜…ã±ã«ã£ã	å¤§ä¹…ä¿
ãƒ¢ãƒã‚¯ãƒ­ãƒ¼ãƒ 	é¦¬å ´ãƒ»ä»®è¨­
ãƒ­ã‚¹ãƒˆï¼ãƒªãƒ¡ãƒ³ãƒ–ãƒ©ãƒ³ã‚¹	å¤§ä¹…ä¿ãƒ»é¦¬å ´ãƒ»ä»®è¨­
æ„›ã™ã‚‹æ•…ã«	
æ¤…å­æˆ¦äº‰	å¤§å¡š
é•äºº	é¦¬å ´ãƒ»ä»®è¨­
ç«ãƒç¥æ§˜ã®ã„ã†ã¨ãŠã‚Š	å¤§ä¹…ä¿
ç´…ãèˆã†	é¦¬å ´ãƒ»ä»®è¨­
å‘Šåˆ¥è©©ï¼ˆå–å¼•ä¸­æ­¢ï¼‰	
æ®ºäººé¬¼Xã®ç‹¬ç™½	å¤§ä¹…ä¿ãƒ»é¦¬å ´ãƒ»ä»®è¨­
å°æš®äº‹ä»¶ã«é–¢ã™ã‚‹è€ƒå¯Ÿ	é¦¬å ´ãƒ»ä»®è¨­
èµ¤ã®å°ç·š	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§å¡š
å‡ã¦ã¤ãã‚ãªãŸã«ï¼–ã¤ã®ç¯ç«	å¤§ä¹…ä¿
å½¼ã¨ã‹ã˜ã¤ã¨ãƒã‚·ãƒ¥ãƒãƒ­ã‚¦	å¤§ä¹…ä¿
å½¼å¥³ã¨ã„ã‚‹ã‹ã¨ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ	å¤§ä¹…ä¿
ä¸æ€è­°ã®å›½ã®ç«¥è©±è£åˆ¤	é¦¬å ´ãƒ»ä»®è¨­
é³´ç¥æ§˜ã®ã„ã†ã¨ãŠã‚Š	å¤§ä¹…ä¿
ç«‹æ–¹é¤¨	é¦¬å ´ãƒ»ä»®è¨­
è£‚ãå­ã•ã‚“	å¤§ä¹…ä¿
ã‚´ãƒ¼ã‚¸ãƒ£ã‚¹ãƒãƒ³ã‚·ãƒ§ãƒ³	é¦¬å ´ãƒ»ä»®è¨­
ãƒãƒ¼ãƒ€ãƒ¼ã‚ªãƒ–ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼å¤±ã‚ã‚Œã—å¤§ç§˜å®	å¤§ä¹…ä¿
æ¼£ã®å‘ã“ã†å´	å¤§ä¹…ä¿
åœŸç‰¢ã«æ‚²é³´ã¯è°ºã—ã¦	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§ä¹…ä¿
ã‚ªãƒšãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼šã‚´ãƒ¼ã‚¹ãƒˆã‚¦ã‚£ãƒ³ã‚°	é¦¬å ´ãƒ»é¦¬å ´ä»®è¨­
ã‚ã‚‹æ‚ªé­”ã®å„€å¼ã«ã¤ã„ã¦	å¤§ä¹…ä¿ãƒ»é¦¬å ´ãƒ»ä»®è¨­
GMæ®ºäººäº‹ä»¶	å…¨åº—èˆ—
BeatSpecter	
WORLDEND	å¤§ä¹…ä¿
ã‚ã‚‹ãƒãƒ¼ãƒ€ãƒ¼ãƒŸã‚¹ãƒ†ãƒªãƒ¼ã«ã¤ã„ã¦	é¦¬å ´ãƒ»ä»®è¨­ãƒ»å¤§ä¹…ä¿
ã‚¨ã‚¤ãƒ€	å¤§ä¹…ä¿
ãƒ–ãƒ©ãƒƒã‚¯ãƒŠã‚¤ãƒˆã‚¹ãƒ¬ã‚¤ãƒ´	
ãƒ¦ãƒ¼ãƒˆãƒ”ã‚¢ãƒ¼ã‚¹	å¤§ä¹…ä¿ãƒ»é¦¬å ´ãƒ»ä»®è¨­
ç‹‚æ°—å±±è„ˆã€€2.5ã€€é ‚ä¸Šæˆ¦äº‰	å¤§ä¹…ä¿
ç‹‚æ°—å±±è„ˆã€€é™°è¬€ã®åˆ†æ°´å¶ºï¼ˆï¼‘ï¼‰	å¤§ä¹…ä¿
ç‹‚æ°—å±±è„ˆã€€æ˜Ÿé™ã‚‹å¤©è¾ºï¼ˆï¼’ï¼‰	å¤§ä¹…ä¿
ç‹‚æ°—å±±è„ˆã€€è–„æ˜ä¸‰è§’ç‚¹ï¼ˆï¼“ï¼‰	å¤§ä¹…ä¿
åˆå‰2æ™‚7åˆ†	
é»’ã„æ£®ã®ç£part1	é¦¬å ´ãƒ»ä»®è¨­
é»’ã„æ£®ã®ç£part2äººã¨ç‹¼	é¦¬å ´ãƒ»ä»®è¨­
é­‚ã‚’é‹ã¶é£›è¡Œèˆ¹	é¦¬å ´ãƒ»ä»®è¨­
äººé¡æœ€å¾Œã®çš†æ§˜ã¸ï¼çµ‚æœ«ã®çœ ã‚Šå§«	å¤§ä¹…ä¿
æ­£ç¾©ã¯ã¾ãŸè˜‡ã‚‹	
å¤©ä½¿ã¯èŠ±æ˜ã‹ã‚Šã®ä¸‹ã§	å¤§ä¹…ä¿
å—æ¥µåœ°ç‚¹X	é¦¬å ´ãƒ»ä»®è¨­
åƒ•ã‚‰ã®æœªæ¥ã«ã¤ã„ã¦	é¦¬å ´ãƒ»ä»®è¨­
é­”å¥³ã®è–é¤å¼	
æµå¹´	é¦¬å ´ãƒ»ä»®è¨­
å»»ã‚‹å¼¾ä¸¸è¼ªèˆï¼ˆãƒ€ãƒ³ã‚¬ãƒ³ãƒ­ãƒ³ãƒ‰ï¼‰	å¤§ä¹…ä¿
TheRealFork30's	å¤§ä¹…ä¿
æª»è¦‹ã‚‹5äºº-ï¼ˆç©ºè‰²æ™‚ç®±ã‚»ãƒƒãƒˆå…¬æ¼”ï¼‰	å¤§ä¹…ä¿
ç©ºè‰²æ™‚ç®±ï¼ˆã‚½ãƒ©ã‚¤ãƒ­ã‚¿ã‚¤ãƒ ã‚«ãƒ—ã‚»ãƒ«ï¼‰-æª»è¦‹ã‚‹ï¼•äººã‚»ãƒƒãƒˆå…¬æ¼”	å¤§ä¹…ä¿
MissingLinkï¼ˆãƒŸãƒƒã‚·ãƒ³ã‚°ãƒªãƒ³ã‚¯ï¼‰	
ã‚¼ãƒ­ã®çˆ†å¼¾	å¤§ä¹…ä¿
èµ¤é¬¼ãŒæ³£ã„ãŸå¤œ	é¦¬å ´ãƒ»ä»®è¨­
è¦ªæ–¹ã®é¤¨	
SORCIERï½è³¢è€…é”ã®ç‰©èªï½	å¤§ä¹…ä¿
ã‚ã®å¤ã®ã‚¢ãƒ³ã‚¿ãƒ¬ã‚¹	
ã‚¨ãƒ³ãƒ‰ãƒ­ãƒ¼ãƒ«ã¯æµã‚Œãªã„	å¤§ä¹…ä¿
å¹»æƒ³ã®ãƒãƒªã‚¹	
Invisible-äº¡éœŠåˆ—è»Š-	é¦¬å ´
å£è£‚ã‘å¥³ã®å¾®ç¬‘ã¿ãƒ»Mã®æ‚ªæ„	
Factor	
ãƒ–ãƒ«ãƒ¼ãƒ€ã‚¤ãƒ¤ã®ä¸åœ¨è¨¼æ˜	å¤§ä¹…ä¿ãƒ»é¦¬å ´ãƒ»ä»®è¨­
Grape	
ãƒ„ã‚¤ãƒ³å·æ²ˆæ²¡äº‹ä»¶ã«é–¢ã™ã‚‹è€ƒå¯Ÿ	
æ·±æµ·ã«æ²ˆã‚€å­ä¾›ãŸã¡ï¼ˆæ°´åº•ã®ã‚¯ã‚ªãƒªã‚¢ï¼‰	
äººç‹¼ãƒ‡ã‚¹ã‚²ãƒ¼ãƒ ã¸ã®æŒ‘æˆ¦	
ã™ã¹ã¦ã¯å±±è˜ã‹ã‚‰å§‹ã¾ã‚‹ã€‚	
å›ãŒç‚ºã®æ®ºäºº	
"""

def main():
    from supabase import create_client
    
    if not SUPABASE_URL or not SUPABASE_KEY:
        print("âŒ Supabaseæ¥ç¶šæƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚.envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚")
        return
    
    supabase = create_client(SUPABASE_URL, SUPABASE_KEY)
    
    # æ—¢å­˜ã‚·ãƒŠãƒªã‚ªã‚’å–å¾—
    result = supabase.table('scenarios').select('id, title').execute()
    existing_scenarios = {s['title']: s['id'] for s in result.data}
    
    print(f"ğŸ“š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…ã®ã‚·ãƒŠãƒªã‚ªæ•°: {len(existing_scenarios)}")
    print()
    
    # ãƒ‡ãƒ¼ã‚¿ã‚’è§£æ
    updates = []
    not_found = []
    errors = []
    
    for line in SCENARIO_STORE_DATA.strip().split('\n'):
        if not line.strip():
            continue
        
        parts = line.split('\t')
        title = parts[0].strip()
        store_text = parts[1].strip() if len(parts) > 1 else ""
        
        if not title:
            continue
        
        # ã‚·ãƒŠãƒªã‚ªIDã‚’æ¤œç´¢
        scenario_id = existing_scenarios.get(title)
        
        if not scenario_id:
            # éƒ¨åˆ†ä¸€è‡´ã§æ¤œç´¢
            for existing_title, existing_id in existing_scenarios.items():
                if title in existing_title or existing_title in title:
                    scenario_id = existing_id
                    print(f"ğŸ”„ ã€Œ{title}ã€â†’ã€Œ{existing_title}ã€ã¨ã—ã¦ãƒãƒƒãƒ")
                    break
        
        if not scenario_id:
            not_found.append(title)
            continue
        
        # åº—èˆ—IDã‚’è§£æ
        store_ids = parse_stores(store_text)
        
        updates.append({
            'id': scenario_id,
            'title': title,
            'store_text': store_text,
            'available_stores': store_ids
        })
    
    print(f"\nâœ… æ›´æ–°å¯¾è±¡: {len(updates)}ä»¶")
    print(f"âŒ ã‚·ãƒŠãƒªã‚ªãŒè¦‹ã¤ã‹ã‚‰ãªã„: {len(not_found)}ä»¶")
    
    if not_found:
        print("\n=== ã‚·ãƒŠãƒªã‚ªãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚‚ã® ===")
        for title in not_found:
            print(f"  - {title}")
    
    # æ›´æ–°ã‚’å®Ÿè¡Œ
    print("\n=== æ›´æ–°ã‚’å®Ÿè¡Œ ===")
    success_count = 0
    fail_count = 0
    
    for update in updates:
        try:
            result = supabase.table('scenarios').update({
                'available_stores': update['available_stores']
            }).eq('id', update['id']).execute()
            
            store_count = len(update['available_stores'])
            is_all = store_count == len(ALL_STORE_IDS)
            store_label = "å…¨åº—èˆ—" if is_all else f"{store_count}åº—èˆ—"
            print(f"âœ… {update['title']}: {store_label}")
            success_count += 1
        except Exception as e:
            print(f"âŒ {update['title']}: ã‚¨ãƒ©ãƒ¼ - {e}")
            fail_count += 1
    
    print(f"\n=== å®Œäº† ===")
    print(f"æˆåŠŸ: {success_count}ä»¶")
    print(f"å¤±æ•—: {fail_count}ä»¶")
    print(f"æœªç™»éŒ²: {len(not_found)}ä»¶")


if __name__ == '__main__':
    main()

